import{j as o,b as N,r as h,m as P,u as I,n as A,N as T,i as D,d as M,e as B}from"./index-isj_SKQs.js";import{L as U}from"./Logo-dP70ctv3.js";import{u as R,F as m,c as v,C as z,A as F,S as H,P as V,p as W}from"./UseForm-0lmo7lJ7.js";import{u as $}from"./userApi-Zo4OLMCS.js";const q="_loginPage_1j4ky_1",K="_logo_1j4ky_9",J="_backgroundImage_1j4ky_15",Y="_formBox_1j4ky_23",f={loginPage:q,logo:K,backgroundImage:J,formBox:Y},G="/assets/indian-male-dancing-9uSN-cbY.svg",Q="_form_15kpu_1",X="_header_15kpu_15",Z="_additionalBox_15kpu_28",ee="_additionalAdvice_15kpu_45",y={form:Q,header:X,additionalBox:Z,additionalAdvice:ee},te="_link_qg99j_1",ie={link:te},k=({href:e,label:t,fontSize:n,onClick:i})=>o.jsx(N,{className:ie.link,to:e,style:{fontSize:n},onClick:i,children:t}),ne=({onSubmitForm:e})=>{const[t,n]=h.useState(""),[i,a]=h.useState(""),[r,s]=h.useState(!1),[c,u,l]=R(()=>e(t,i,r)),p=h.useCallback(()=>l([{value:t,type:m.EMAIL},{value:i,type:m.PASSWORD}]),[l,t,i]);return o.jsxs("form",{className:y.form,children:[o.jsxs("div",{className:y.header,children:[o.jsx("h1",{children:"С возвращением!"}),o.jsx("h5",{children:"Пожалуйста введите свои данные"})]}),o.jsx(v,{type:m.EMAIL,label:"Электронная почта",value:t,setValue:n,error:c.find(d=>d.inputType===m.EMAIL),removeError:u,autocomplete:"email"}),o.jsx(v,{type:m.PASSWORD,label:"Пароль",value:i,setValue:a,error:c.find(d=>d.inputType===m.PASSWORD),removeError:u,autocomplete:"current-password"}),o.jsxs("div",{className:y.additionalBox,children:[o.jsxs("div",{children:[o.jsx(z,{onChange:()=>s(!r)}),o.jsx("span",{children:"Запомнить меня на 30 дней"})]}),o.jsx(k,{href:"https://youtube.com",label:"Забыли пароль?",fontSize:18})]}),o.jsx(F,{label:"Войти",iconClasses:"",styleType:H.PRIMARY,onClick:p,height:37}),o.jsxs("div",{className:y.additionalAdvice,children:[o.jsx("span",{children:"Нету аккаунта?"}),o.jsx(k,{href:"https://youtube.com",label:"Зарегистрироваться",fontSize:16})]})]})},oe="_codePopup_1wjhk_1",se="_header_1wjhk_22",w={codePopup:oe,header:se},re="_inputBox_10ttw_1",ae="_inputs_10ttw_10",ce="_error_10ttw_35",S={inputBox:re,inputs:ae,error:ce},ue=({onInputSubmit:e,isError:t,removeError:n,resendCode:i})=>{const a=()=>{let c="";const u=document.getElementById("codeInputs");for(const l of u.children)c+=l.value;return c},r=c=>{n();const u=a(),l=c.currentTarget;u.length===6&&e(u);const p=l.value?l.nextElementSibling:l.previousElementSibling;p==null||p.focus()},s=[S.inputBox,t?S.error:void 0].join(" ");return o.jsxs("div",{className:s,children:[o.jsxs("div",{id:"codeInputs",className:S.inputs,children:[o.jsx("input",{type:"tel",maxLength:1,pattern:"[0-9]",required:!0,onInput:r}),o.jsx("input",{type:"tel",maxLength:1,pattern:"[0-9]",required:!0,onInput:r}),o.jsx("input",{type:"tel",maxLength:1,pattern:"[0-9]",required:!0,onInput:r}),o.jsx("input",{type:"tel",maxLength:1,pattern:"[0-9]",required:!0,onInput:r}),o.jsx("input",{type:"tel",maxLength:1,pattern:"[0-9]",required:!0,onInput:r}),o.jsx("input",{type:"tel",maxLength:1,pattern:"[0-9]",required:!0,onInput:r})]}),o.jsxs("span",{children:["Не получили код? ",o.jsx(k,{href:"#",label:"Отправить заново",fontSize:14,onClick:i})]})]})},le=P.injectEndpoints({endpoints:e=>({sendCode:e.mutation({query:t=>({url:"/send-code",method:"POST",responseHandler:"content-type",body:t})}),checkCode:e.mutation({query:t=>({url:"/check-code",method:"POST",responseHandler:"content-type",body:t})})})}),{useSendCodeMutation:C,useCheckCodeMutation:de}=le,pe=({popupVisible:e,userCredentials:t,onSuccessSubmit:n})=>{const[i,a]=h.useState(!1),[r]=de(),[s]=C(),c=I();if(!t)return null;const u=async p=>{try{const d=await r({code:p,email:t.email,rememberMe:t.rememberMe,ip:t.ip}).unwrap();n(d.code,d.email)}catch{a(!0)}},l=async()=>{await s(t.email),c(A.actions.openNotification({advice:"Проверьте почту и введите код",description:"Код отправлен",type:T.SUCCESS,id:new Date().toISOString()}))};return o.jsx(V,{popupVisible:e,children:o.jsxs("div",{className:w.codePopup,children:[o.jsxs("div",{className:w.header,children:[o.jsx("h2",{children:"Проверьте вашу почту"}),o.jsxs("h5",{children:["Мы отправили код на ",t.email]})]}),o.jsx(ue,{onInputSubmit:u,isError:i,removeError:()=>a(!1),resendCode:l})]})})};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var O=me,b=ge,he=Object.prototype.toString,x=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function me(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var n={},i=t||{},a=i.decode||fe,r=0;r<e.length;){var s=e.indexOf("=",r);if(s===-1)break;var c=e.indexOf(";",r);if(c===-1)c=e.length;else if(c<s){r=e.lastIndexOf(";",s-1)+1;continue}var u=e.slice(r,s).trim();if(n[u]===void 0){var l=e.slice(s+1,c).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1)),n[u]=je(l,a)}r=c+1}return n}function ge(e,t,n){var i=n||{},a=i.encode||ye;if(typeof a!="function")throw new TypeError("option encode is invalid");if(!x.test(e))throw new TypeError("argument name is invalid");var r=a(t);if(r&&!x.test(r))throw new TypeError("argument val is invalid");var s=e+"="+r;if(i.maxAge!=null){var c=i.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");s+="; Max-Age="+Math.floor(c)}if(i.domain){if(!x.test(i.domain))throw new TypeError("option domain is invalid");s+="; Domain="+i.domain}if(i.path){if(!x.test(i.path))throw new TypeError("option path is invalid");s+="; Path="+i.path}if(i.expires){var u=i.expires;if(!xe(u)||isNaN(u.valueOf()))throw new TypeError("option expires is invalid");s+="; Expires="+u.toUTCString()}if(i.httpOnly&&(s+="; HttpOnly"),i.secure&&(s+="; Secure"),i.priority){var l=typeof i.priority=="string"?i.priority.toLowerCase():i.priority;switch(l){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(i.sameSite){var p=typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite;switch(p){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return s}function fe(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function ye(e){return encodeURIComponent(e)}function xe(e){return he.call(e)==="[object Date]"||e instanceof Date}function je(e,t){try{return t(e)}catch{return e}}function Se(){return typeof document=="object"&&typeof document.cookie=="string"}function _e(e){return typeof e=="string"?O(e):typeof e=="object"&&e!==null?e:{}}function _(e,t={}){const n=ke(e);if(!t.doNotParse)try{return JSON.parse(n)}catch{}return e}function ke(e){return e&&e[0]==="j"&&e[1]===":"?e.substr(2):e}class ve{constructor(t,n={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const a=this.cookies;this.cookies=O(document.cookie),this._checkChanges(a)};const i=typeof document>"u"?"":document.cookie;this.cookies=_e(t||i),this.defaultSetOptions=n,this.HAS_DOCUMENT_COOKIE=Se()}_emitChange(t){for(let n=0;n<this.changeListeners.length;++n)this.changeListeners[n](t)}_checkChanges(t){new Set(Object.keys(t).concat(Object.keys(this.cookies))).forEach(i=>{t[i]!==this.cookies[i]&&this._emitChange({name:i,value:_(t[i])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(t,n={}){return n.doNotUpdate||this.update(),_(this.cookies[t],n)}getAll(t={}){t.doNotUpdate||this.update();const n={};for(let i in this.cookies)n[i]=_(this.cookies[i],t);return n}set(t,n,i){i?i=Object.assign(Object.assign({},this.defaultSetOptions),i):i=this.defaultSetOptions;const a=typeof n=="string"?n:JSON.stringify(n);this.cookies=Object.assign(Object.assign({},this.cookies),{[t]:a}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=b(t,a,i)),this._emitChange({name:t,value:n,options:i})}remove(t,n){const i=n=Object.assign(Object.assign({},n),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[t],this.HAS_DOCUMENT_COOKIE&&(document.cookie=b(t,"",i)),this._emitChange({name:t,value:void 0,options:n})}addChangeListener(t){this.changeListeners.push(t),this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(t){const n=this.changeListeners.indexOf(t);n>=0&&this.changeListeners.splice(n,1),this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}const we=(e,t)=>new Promise((n,i)=>{t(e).unwrap().then(a=>{n(a)}).catch(a=>be(a,i))}),be=(e,t)=>{if(typeof e.data=="object"&&D(e.data)){const n=e.data;t(n)}},Ne=()=>{const[e,t]=h.useState(!1),[n]=$(),[i]=C(),[a]=M(),[r,s]=h.useState(),c=B(),u=new ve(null,{path:"/",expires:W(new Date,30)}),l=(d,g)=>{u.set("code",d),u.set("email",g),c("/dashboard")},p=async(d,g,E)=>{const L={email:d,password:g};try{await we(L,n),await i(d);const{data:j}=await a();s({rememberMe:E,email:d,password:g,ip:j}),t(!0)}catch(j){console.log(`Failed to login: ${j}`)}};return o.jsxs("div",{className:f.loginPage,children:[o.jsx(U,{className:f.logo}),o.jsx("img",{className:f.backgroundImage,src:G,alt:"background"}),o.jsxs("div",{className:f.formBox,children:[o.jsx(pe,{popupVisible:e,userCredentials:r,onSuccessSubmit:l}),o.jsx(ne,{onSubmitForm:p})]})]})};export{Ne as default};
